define(["require","exports","../global","../has","./utils"],function(t,e,r,n,l){var s,i,o,a=function(){var e=this,t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(s){e[s]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t[s].apply(t,e)}})},c=r.MutationObserver||r.WebKitMutationObserver,d=(r.process&&r.process.nextTick?s=function(e){r.process.nextTick(e)}:r.Promise?s=function(e){r.Promise.resolve().then(e)}:c&&(i=[],o=document.createElement("div"),new c(function(){for(;0<i.length;)i.shift()()}).observe(o,{attributes:!0}),s=function(e){i.push(e),o.setAttribute("queueStatus","1")}),s);return p.prototype.terminate=function(){},Object.defineProperty(p.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),(this._onmessageHandler=e)&&this.addEventListener("message",e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),(this._onerrorHandler=e)&&this.addEventListener("error",e)},enumerable:!0,configurable:!0}),p.prototype.postMessage=function(e,r){var s=this;d(function(){s._workerMessageHandler(new MessageEvent("message",{data:e}))})},p.prototype.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},p.prototype.addEventListener=function(e,r,s){this._dispatcher.addEventListener(e,r,s)},p.prototype.removeEventListener=function(e,r,s){this._dispatcher.removeEventListener(e,r,s)},p.prototype._workerPostMessage=function(e,r){var s=this;d(function(){s.dispatchEvent(new MessageEvent("message",{data:e}))})},p.prototype._workerMessageHandler=function(e){var p=this,r=l.receiveMessage(e);if(r){var u=r.jobId;switch(r.type){case l.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:l.MessageType.CONFIGURED});break;case l.MessageType.OPEN:var s=r.modulePath;n("esri-webpack")?t(["esri/core/workers/RemoteClient","esri/tasks/operations/PBFWorker","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline","esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",s],function(e,r,s,t,n,i,o,a,c){var d;switch(c){case"esri/tasks/operations/PBFWorker":d=r;break;case"esri/views/vectorTiles/WorkerTileHandler":d=s;break;case"esri/views/2d/layers/features/Pipeline":d=t;break;case"esri/views/3d/layers/PointCloudWorker":d=n;break;case"esri/views/3d/layers/SceneLayerWorker":d=i;break;case"esri/layers/graphics/sources/support/CSVSourceWorker":d=o;break;case"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":d=a;break;default:d=c}e=e.connect(d);p._workerPostMessage({type:l.MessageType.OPENED,jobId:u,data:e})}):t(["esri/core/workers/RemoteClient",s],function(e,r){r=e.connect(r);p._workerPostMessage({type:l.MessageType.OPENED,jobId:u,data:r})})}}},p;function p(){this._dispatcher=new a,this._isInitialized=!1,this._workerPostMessage({type:l.MessageType.HANDSHAKE})}});