define(["require","exports","../has","../Logger","../promiseUtils","./Connection","./RemoteClient","./WorkerOwner"],function(o,a,e,n,c,t,r,i){function u(){if(w)return w;for(var e=l+f,t=[],n=0;n<e;n++)!function(n){var e=i.create(n).then(function(e){return h[n]=e});t.push(e)}(n);return w=c.all(t).then(function(){})}Object.defineProperty(a,"__esModule",{value:!0}),a.Connection=t,a.RemoteClient=r;var r=(r=e("host-browser")?navigator.hardwareConcurrency:0)||(e("safari")&&e("mac")||e("trident")?8:2),l=e("esri-workers-debug")?1:Math.max(1,Math.ceil(r/2)),f=e("esri-workers-debug")?1:Math.max(1,Math.floor(r/2)),s=n.getLogger("esri.core.workers"),d=0,h=[];a.initialize=function(){u()},a.open=function(t,n,e){if(void 0===n&&(n={}),Array.isArray(t))return new a.Connection(t.map(function(e){return new a.RemoteClient(e,n.client)}));var r;"string"!=typeof t&&(s.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature."),r=t,t=n,n={client:r,strategy:e?"dedicated":"distributed"});var i=n.strategy||"distributed";return"local"===i?c.create(function(n){o([t],function(e){n(a.RemoteClient.connect(e))})}).then(function(e){return new a.Connection([new a.RemoteClient(e,n.client)])}):u().then(function(){if("dedicated"!==i)return c.all(h.map(function(e){return e.open(t)})).then(function(e){return new a.Connection(e.map(function(e){return new a.RemoteClient(e,n.client)}))});var e=l+d++;return d%=f,h[e].open(t).then(function(e){return new a.Connection([new a.RemoteClient(e,n.client)])})})},a.terminate=function(){w&&(w.cancel(),w=null);for(var e=0;e<h.length;e++)h[e]&&h[e].terminate();h.length=0};var w=null});